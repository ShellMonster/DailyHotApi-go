# Docker é•œåƒå‘å¸ƒæŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•å°† DailyHotApi-Go æ‰“åŒ…æˆ Docker é•œåƒï¼Œå¹¶æ¨é€åˆ° Docker Hub æˆ–å…¶ä»–å®¹å™¨æ³¨å†Œè¡¨ï¼Œä¾›å…¶ä»–äººä½¿ç”¨ `docker run` å‘½ä»¤ç›´æ¥è¿è¡Œã€‚

---

## æ­¥éª¤ 1ï¸âƒ£ï¼šæ„å»ºæœ¬åœ°é•œåƒ

### å‰ç½®æ¡ä»¶
- å·²å®‰è£… Dockerï¼ˆ[å®‰è£…æŒ‡å—](https://docs.docker.com/get-docker/)ï¼‰
- é¡¹ç›®æ ¹ç›®å½•ä¸­æœ‰ Dockerfile å’Œ go.mod

### æ„å»ºé•œåƒå‘½ä»¤

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd DailyHotApi-Go

# æ„å»ºé•œåƒ
# æ ¼å¼: docker build -t [é•œåƒåç§°]:[æ ‡ç­¾] .
# ç¤ºä¾‹:
docker build -t dailyhot-api-go:1.0.0 .

# æˆ–è€…ä½¿ç”¨æœ€æ–°æ ‡ç­¾
docker build -t dailyhot-api-go:latest .
```

### éªŒè¯é•œåƒæ˜¯å¦æ„å»ºæˆåŠŸ

```bash
# åˆ—å‡ºæœ¬åœ°é•œåƒ
docker images | grep dailyhot-api-go

# é¢„æœŸè¾“å‡º:
# REPOSITORY        TAG       IMAGE ID       CREATED         SIZE
# dailyhot-api-go   1.0.0     abc123...      5 minutes ago   50MB
# dailyhot-api-go   latest    abc123...      5 minutes ago   50MB
```

---

## æ­¥éª¤ 2ï¸âƒ£ï¼šæœ¬åœ°æµ‹è¯•è¿è¡Œ

åœ¨æ¨é€å‰ï¼Œå»ºè®®å…ˆåœ¨æœ¬åœ°æµ‹è¯•é•œåƒæ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œï¼š

```bash
# åŸºæœ¬è¿è¡Œï¼ˆæ— é…ç½®ï¼‰
docker run -p 6688:6688 dailyhot-api-go:1.0.0

# å¸¦é…ç½®æ–‡ä»¶è¿è¡Œ
docker run -p 6688:6688 \
  -v /path/to/config.yaml:/app/config.yaml \
  dailyhot-api-go:1.0.0

# åå°è¿è¡Œ
docker run -d -p 6688:6688 \
  --name dailyhot \
  dailyhot-api-go:1.0.0

# æŸ¥çœ‹è¿è¡Œæ—¥å¿—
docker logs dailyhot

# æµ‹è¯• API æ˜¯å¦å¯ç”¨
curl http://localhost:6688/health
```

---

## æ­¥éª¤ 3ï¸âƒ£ï¼šæ¨é€åˆ° Docker Hub

### 3.1 åˆ›å»º Docker Hub è´¦æˆ·
- è®¿é—® [Docker Hub](https://hub.docker.com/)
- æ³¨å†Œè´¦æˆ·ï¼ˆä½ çš„ç”¨æˆ·åä¸º `ShellMonster`ï¼‰

### 3.2 ç™»å½• Docker

```bash
docker login

# è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼ˆæˆ–è®¿é—®ä»¤ç‰Œï¼‰
# Username: ShellMonster
# Password: â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢
```

### 3.3 ç»™é•œåƒæ‰“æ ‡ç­¾

æ ‡ç­¾æ ¼å¼ï¼š`docker_username/repository_name:tag`

```bash
# ç»™é•œåƒé‡æ–°æ ‡è®°ä¸º Docker Hub æ ¼å¼
# æ ¼å¼: docker tag [æœ¬åœ°é•œåƒå]:[æ ‡ç­¾] [Dockerç”¨æˆ·å]/[ä»“åº“å]:[æ ‡ç­¾]

docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:1.0.0
docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:latest

# éªŒè¯æ ‡ç­¾
docker images | grep ShellMonster/dailyhot-api-go
```

### 3.4 æ¨é€é•œåƒåˆ° Docker Hub

```bash
# æ¨é€ç‰¹å®šç‰ˆæœ¬
docker push ShellMonster/dailyhot-api-go:1.0.0

# æ¨é€ latest æ ‡ç­¾ï¼ˆæœ€æ–°ç‰ˆæœ¬ï¼‰
docker push ShellMonster/dailyhot-api-go:latest
```

æ¨é€å®Œæˆåï¼Œä½ ä¼šåœ¨ Docker Hub ä¸Šçœ‹åˆ°è¿™ä¸ªé•œåƒï¼š
`https://hub.docker.com/r/ShellMonster/dailyhot-api-go`

---

## æ­¥éª¤ 4ï¸âƒ£ï¼šå…¶ä»–äººå¦‚ä½•ä½¿ç”¨ä½ çš„é•œåƒ

### 4.1 æ‹‰å–é•œåƒ

```bash
docker pull ShellMonster/dailyhot-api-go:1.0.0

# æˆ–æ‹‰å–æœ€æ–°ç‰ˆæœ¬
docker pull ShellMonster/dailyhot-api-go:latest
```

### 4.2 è¿è¡Œé•œåƒ

```bash
# ç®€å•è¿è¡Œ
docker run -p 6688:6688 ShellMonster/dailyhot-api-go:1.0.0

# ä½¿ç”¨ docker-compose è¿è¡Œ
cat > docker-compose.yml << 'EOF'
version: '3.8'
services:
  api:
    image: ShellMonster/dailyhot-api-go:1.0.0
    ports:
      - "6688:6688"
    environment:
      - DAILYHOT_SERVER_PORT=6688
      - DAILYHOT_REDIS_ENABLED=false
    volumes:
      - ./config.yaml:/app/config.yaml
    restart: unless-stopped
EOF

docker-compose up -d
```

---

## æ­¥éª¤ 5ï¸âƒ£ï¼šä½¿ç”¨å…¶ä»– Registryï¼ˆå¯é€‰ï¼‰

### 5.1 æ¨é€åˆ°é˜¿é‡Œäº‘ï¼ˆä¸­å›½å†…åœ°ï¼‰

```bash
# 1. ç™»å½•é˜¿é‡Œäº‘
docker login --username=your_aliyun_username registry.cn-hangzhou.aliyuncs.com

# 2. ç»™é•œåƒæ‰“æ ‡ç­¾
docker tag dailyhot-api-go:1.0.0 registry.cn-hangzhou.aliyuncs.com/ShellMonster/dailyhot-api-go:1.0.0

# 3. æ¨é€
docker push registry.cn-hangzhou.aliyuncs.com/ShellMonster/dailyhot-api-go:1.0.0
```

### 5.2 æ¨é€åˆ° GitHub Container Registry

```bash
# 1. åˆ›å»º GitHub è®¿é—®ä»¤ç‰Œï¼ˆSettings > Developer settings > Personal access tokensï¼‰
# 2. ç™»å½•
echo $YOUR_TOKEN | docker login ghcr.io -u ShellMonster --password-stdin

# 3. ç»™é•œåƒæ‰“æ ‡ç­¾
docker tag dailyhot-api-go:1.0.0 ghcr.io/ShellMonster/dailyhot-api-go:1.0.0

# 4. æ¨é€
docker push ghcr.io/ShellMonster/dailyhot-api-go:1.0.0
```

---

## æœ€ä½³å®è·µ âœ…

### ç‰ˆæœ¬ç®¡ç†

```bash
# ä¸ºæ¯ä¸ªå‘å¸ƒç‰ˆæœ¬åˆ›å»ºä¸åŒçš„æ ‡ç­¾
docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:1.0.0
docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:v1.0
docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:latest

docker push ShellMonster/dailyhot-api-go:1.0.0
docker push ShellMonster/dailyhot-api-go:v1.0
docker push ShellMonster/dailyhot-api-go:latest
```

### ä½¿ç”¨ docker-compose.yml

åˆ›å»ºå®Œæ•´çš„éƒ¨ç½²é…ç½®ä¾›å…¶ä»–äººä½¿ç”¨ï¼š

```yaml
version: '3.8'

services:
  api:
    image: ShellMonster/dailyhot-api-go:latest
    container_name: dailyhot-api
    ports:
      - "6688:6688"
    environment:
      - DAILYHOT_SERVER_PORT=6688
      - DAILYHOT_LOG_LEVEL=info
      - DAILYHOT_REDIS_ENABLED=false
    volumes:
      - ./config.yaml:/app/config.yaml
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:6688/health"]
      interval: 30s
      timeout: 3s
      retries: 3

  # å¯é€‰ï¼šæ·»åŠ  Redis
  redis:
    image: redis:7-alpine
    container_name: dailyhot-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped

volumes:
  redis-data:
```

### é•œåƒå¤§å°ä¼˜åŒ–

å½“å‰ Dockerfile å·²ç»ä¼˜åŒ–äº†ï¼š
- âœ… å¤šé˜¶æ®µæ„å»ºï¼ˆåªåŒ…å«æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰
- âœ… Alpine åŸºç¡€é•œåƒï¼ˆè½»é‡çº§ï¼‰
- âœ… å»é™¤è°ƒè¯•ä¿¡æ¯ï¼ˆ`-ldflags="-s -w"`ï¼‰
- âœ… é™æ€ç¼–è¯‘ï¼ˆ`CGO_ENABLED=0`ï¼‰

é¢„æœŸé•œåƒå¤§å°ï¼š**~50MB**

---

## å‘½ä»¤é€ŸæŸ¥è¡¨

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| æ„å»ºé•œåƒ | `docker build -t dailyhot-api-go:1.0.0 .` |
| æœ¬åœ°è¿è¡Œ | `docker run -p 6688:6688 dailyhot-api-go:1.0.0` |
| ç™»å½• Docker Hub | `docker login` |
| æ ‡è®°é•œåƒ | `docker tag dailyhot-api-go:1.0.0 ShellMonster/dailyhot-api-go:1.0.0` |
| æ¨é€åˆ° Docker Hub | `docker push ShellMonster/dailyhot-api-go:1.0.0` |
| æ‹‰å–é•œåƒ | `docker pull ShellMonster/dailyhot-api-go:1.0.0` |
| åˆ—å‡ºæœ¬åœ°é•œåƒ | `docker images` |
| æŸ¥çœ‹è¿è¡Œæ—¥å¿— | `docker logs container_id` |
| åœæ­¢å®¹å™¨ | `docker stop container_id` |
| åˆ é™¤é•œåƒ | `docker rmi image_id` |

---

## å¸¸è§é—®é¢˜

### Q: é•œåƒæ„å»ºå¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°ä¾èµ–ï¼Ÿ
**A:** å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ã€‚å°è¯•ä¿®æ”¹ `Dockerfile` ä¸­çš„ GOPROXYï¼š
```dockerfile
# å›½å†…:
ENV GOPROXY=https://goproxy.cn,direct
# å›½é™…:
ENV GOPROXY=https://proxy.golang.org,direct
```

### Q: é•œåƒè¿è¡Œåæ— æ³•è®¿é—® APIï¼Ÿ
**A:** æ£€æŸ¥ç«¯å£æ˜ å°„ï¼š
```bash
# æ­£ç¡®çš„æ˜ å°„
docker run -p 6688:6688 ShellMonster/dailyhot-api-go:1.0.0

# éªŒè¯å®¹å™¨æ˜¯å¦è¿è¡Œ
docker ps | grep dailyhot-api-go
```

### Q: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Ÿ
**A:** ä½¿ç”¨ docker-compose æˆ– Kubernetesï¼š
```bash
# docker-compose
docker-compose up -d

# æˆ–è€… Kubernetes
kubectl apply -f deployment.yaml
```

### Q: å¦‚ä½•æ›´æ–°é•œåƒï¼Ÿ
**A:** ä¿®æ”¹ä»£ç åé‡æ–°æ„å»ºå’Œæ¨é€ï¼š
```bash
# ä¿®æ”¹ä»£ç ...
git add .
git commit -m "Update features"

# æ„å»ºæ–°ç‰ˆæœ¬
docker build -t dailyhot-api-go:1.0.1 .

# æ‰“æ ‡ç­¾å¹¶æ¨é€
docker tag dailyhot-api-go:1.0.1 ShellMonster/dailyhot-api-go:1.0.1
docker push ShellMonster/dailyhot-api-go:1.0.1
```

---

## ä¸‹ä¸€æ­¥

1. âœ… åœ¨æœ¬åœ°æ„å»ºå¹¶æµ‹è¯•é•œåƒ
2. ğŸ“¤ åˆ›å»º Docker Hub è´¦æˆ·å¹¶æ¨é€
3. ğŸ“‹ åˆ›å»º README.md è¯´æ˜å¦‚ä½•ä½¿ç”¨ä½ çš„é•œåƒ
4. ğŸš€ åˆ†äº«é•œåƒ URL ç»™å…¶ä»–å¼€å‘è€…

