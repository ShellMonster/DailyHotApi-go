# 🚀 DailyHotApi-Go Docker 快速上手指南

## 一句话总结

**一键构建并推送到 Docker Hub，让任何人都能直接 `docker run` 使用你的 Go 版 API**

---

## ⚡ 5 分钟快速开始

### 1️⃣ 构建本地镜像（2 分钟）

```bash
cd DailyHotApi-Go

# 方式 A: 使用自动化脚本（推荐）
chmod +x build-and-push.sh
./build-and-push.sh 1.0.0

# 方式 B: 手动构建
docker build -t dailyhot-api-go:1.0.0 .
```

### 2️⃣ 本地测试（1 分钟）

```bash
# 启动容器
docker run -d -p 6688:6688 --name dailyhot dailyhot-api-go:1.0.0

# 测试 API
curl http://localhost:6688/health

# 停止容器
docker stop dailyhot
```

### 3️⃣ 推送到 Docker Hub（2 分钟）

```bash
# 登录 Docker Hub（首次需要）
docker login

# 使用脚本一键推送
./build-and-push.sh 1.0.0 your_docker_username

# 或手动推送
docker tag dailyhot-api:1.0.0 your_docker_username/dailyhot-api:1.0.0
docker push your_docker_username/dailyhot-api:1.0.0
```

✅ **完成！** 镜像已发布到 Docker Hub

---

## 📦 其他人如何使用你的镜像

### 最简单的方式

```bash
# 直接拉取并运行
docker pull your_docker_username/dailyhot-api-go:1.0.0
docker run -p 6688:6688 your_docker_username/dailyhot-api-go:1.0.0
```

### 使用 docker-compose（推荐）

```bash
# 创建配置文件
cp docker-compose.example.yml docker-compose.yml

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f api

# 停止服务
docker-compose down
```

---

## 📋 文件说明

| 文件 | 说明 |
|------|------|
| `Dockerfile` | 镜像定义文件（多阶段构建，最终镜像 ~50MB，输出 dailyhot-api-go） |
| `build-and-push.sh` | 一键构建和推送脚本（镜像名称：dailyhot-api-go） |
| `docker-compose.example.yml` | docker-compose 配置示例 |
| `镜像发布指南.md` | 详细的发布指南 |
| `快速上手.md` | 本文件 |

---

## 🎯 常见场景

### 场景 1: 本地开发

```bash
# 构建本地镜像
docker build -t dailyhot-api-go:dev .

# 挂载代码目录进行开发
docker run -p 6688:6688 \
  -v $(pwd):/app \
  dailyhot-api-go:dev
```

### 场景 2: 团队共享

```bash
# 推送到 Docker Hub
./build-and-push.sh 1.0.0 your_username

# 团队成员可以直接使用
docker pull your_username/dailyhot-api-go:1.0.0
docker-compose up -d
```

### 场景 3: 生产部署

```bash
# 使用生产级 docker-compose 配置
cp docker-compose.example.yml docker-compose.yml

# 启用 Redis 缓存（编辑 docker-compose.yml）
# 取消注释 redis 服务和相关配置

# 启动
docker-compose up -d

# 监控健康状态
docker-compose ps
```

### 场景 4: CI/CD 自动化

```bash
# 在 GitHub Actions 或 GitLab CI 中使用
# .github/workflows/docker.yml

name: Build and Push Docker Image
on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: docker/setup-buildx-action@v1
      - uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      - uses: docker/build-push-action@v2
        with:
          push: true
          tags: ${{ secrets.DOCKER_USERNAME }}/dailyhot-api:${{ github.ref_name }}
```

---

## 🔍 检查清单

构建前检查：
- ✅ Dockerfile 存在且有效
- ✅ `go.mod` 和 `go.sum` 存在
- ✅ Docker 已安装并运行
- ✅ （推送时）Docker Hub 账户已创建

推送前检查：
- ✅ 已登录 Docker Hub：`docker login`
- ✅ 版本号设置正确
- ✅ Docker 用户名正确

---

## 📊 镜像信息

| 项 | 值 |
|----|-----|
| **基础镜像** | alpine:latest（轻量级） |
| **编译环境** | golang:1.21-alpine |
| **最终大小** | ~50MB |
| **暴露端口** | 6688 |
| **健康检查** | ✅ 已配置 |
| **用户权限** | 非 root（app:app） |
| **重启策略** | Unless-stopped |

---

## 🆘 常见问题

**Q: 脚本执行失败？**
```bash
# 确保脚本可执行
chmod +x build-and-push.sh
```

**Q: Docker 未登录？**
```bash
docker login
# 输入用户名和密码（或访问令牌）
```

**Q: 镜像推送超时？**
```bash
# 检查网络连接，尝试使用国内镜像源
# 编辑 Dockerfile，修改 GOPROXY 为 goproxy.cn
```

**Q: 容器无法启动？**
```bash
# 查看详细错误信息
docker logs container_id

# 检查端口是否被占用
lsof -i :6688
```

**Q: 如何更新镜像？**
```bash
# 修改代码后，以新版本号重新构建
./build-and-push.sh 1.0.1 your_username

# 其他人更新
docker pull your_username/dailyhot-api-go:1.0.1
```

---

## 📖 更多信息

- 📚 详细指南：查看 `镜像发布指南.md`
- 🔧 Docker 文档：https://docs.docker.com/
- 🐳 Docker Hub：https://hub.docker.com/
- 📦 Docker Compose：https://docs.docker.com/compose/

---

## 💡 最佳实践建议

1. **版本管理**
   - 使用语义化版本 `v1.0.0`
   - 每次重要更新推送新版本

2. **标签管理**
   - `latest` - 最新版本
   - `v1.0.0` - 具体版本
   - `stable` - 稳定版本

3. **文档**
   - 在 Docker Hub 上添加 README
   - 说明如何使用你的镜像
   - 列出支持的环境变量

4. **安全性**
   - 使用非 root 用户运行（已配置 ✅）
   - 定期更新基础镜像
   - 使用 Alpine 基础镜像减少攻击面

5. **性能**
   - 利用 Docker 缓存层
   - 多阶段构建只包含最终产物
   - 定期清理未使用的镜像

---

## 🎉 完成后

镜像推送成功后，你可以：

1. **在 Docker Hub 上分享**
   - 链接：`https://hub.docker.com/r/your_username/dailyhot-api-go`
   - 邀请团队成员

2. **创建 README**
   ```markdown
   # DailyHotApi-Go

   一个快速获取各平台热榜数据的 Go API

   ## 快速开始

   ```bash
   docker pull your_username/dailyhot-api-go:latest
   docker run -p 6688:6688 your_username/dailyhot-api-go:latest
   ```
   ```

3. **发布到社区**
   - 分享到 GitHub
   - 发布到技术社区
   - 邀请他人贡献

---

祝你打包顺利！🚀

